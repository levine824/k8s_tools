# K8S组件使用规范

# 1   组件使用规范

## 1.1  持久化卷使用规范

### 1.1.1 规范目的

明确什么情况下需要使用持久化卷

### 1.1.2 规范

持久化卷的存储方式主要有NFS、GFS、CFS，这里我们不讨论第三方提供的存储

持久化卷是基于网络存储的

对于那些对读写效率要求高的文件不建议存储到持久化卷

主要针对实时性要求不高、数据量庞大的文件

## 1.2  容器集群规范

### 1.2.1 规范目的

明确在不同场景下，选择合适的集群方式

### 1.2.2 规范

两种方式：多副本，多pod

多副本的方式

由于只是同一个pod的多个副本，在升级的时候无法做到平滑过渡，这种方式适合允许停止服务的环境，即更新pod会停掉这个容器提供的服务，没有其它容器会提供这些服务，会出现短暂服务停止的现象

 

多pod方式

是指一开始创建同个应用的多个pod，更新的时候可以一个一个更新，这样可以做到用户无感知，适合那些服务不能停止的场景。

## 1.3  配置文件使用规范

### 1.3.1 规范目的

针对常修改和不常修改的配置文件进行区分，选择合适的存储方式

### 1.3.2 规范

有第三方工程管理的配置文件

​    有第三方平台管理，不在K8S里面做处理

不常修改的文件

​    建议创建configmap，避免这类文件太多的情况下，如果使用文件映射容易造成混乱，同时，configmap相对于文件映射的方式，不依赖于共享存储

常修改的文件

​    建议作为文件夹映射到宿主机或者持久化卷，具体如何选择，参考持久化卷的要求，如果不满足则直接映射到宿主机上

## 1.4  文件目录映射规范

### 1.4.1 规范目的

针对具体的场景分析，什么样的文件及目录需要进行映射

### 1.4.2 规范

日志文件

目前想到的就是日志文件目录需要进行映射，前提是日志量大，对IO要求高；对IO要求不高的情况下可以采用持久化卷的方式存储